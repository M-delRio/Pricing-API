  [1m[35m (32.7ms)[0m  [1m[35mDROP DATABASE IF EXISTS "sec_storage_test"[0m
  [1m[35m (291.1ms)[0m  [1m[35mCREATE DATABASE "sec_storage_test" ENCODING = 'utf8'[0m
  [1m[35mSQL (1.0ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (17.4ms)[0m  [1m[35mDROP TABLE IF EXISTS "criteria" CASCADE[0m
  [1m[35m (37.5ms)[0m  [1m[35mCREATE TABLE "criteria" ("id" bigserial primary key, "type" character varying NOT NULL, "start" integer NOT NULL, "end" integer, "discount_id" bigint NOT NULL)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE  INDEX  "index_criteria_on_discount_id" ON "criteria"  ("discount_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "customers" CASCADE[0m
  [1m[35m (3.0ms)[0m  [1m[35mCREATE TABLE "customers" ("id" bigserial primary key)[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "discounts" CASCADE[0m
  [1m[35m (3.0ms)[0m  [1m[35mCREATE TABLE "discounts" ("id" bigserial primary key, "is_flat" boolean NOT NULL, "type" character varying, "type_value" integer NOT NULL, "rate_id" bigint NOT NULL)[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE  INDEX  "index_discounts_on_rate_id" ON "discounts"  ("rate_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "rates" CASCADE[0m
  [1m[35m (3.4ms)[0m  [1m[35mCREATE TABLE "rates" ("id" bigserial primary key, "customer_id" bigint NOT NULL)[0m
  [1m[35m (1.8ms)[0m  [1m[35mCREATE  INDEX  "index_rates_on_customer_id" ON "rates"  ("customer_id")[0m
  [1m[35m (0.4ms)[0m  [1m[35mDROP TABLE IF EXISTS "surcharges" CASCADE[0m
  [1m[35m (7.4ms)[0m  [1m[35mCREATE TABLE "surcharges" ("id" bigserial primary key, "item_property" character varying NOT NULL, "type" character varying NOT NULL, "type_value" integer NOT NULL, "rate_id" bigint NOT NULL)[0m
  [1m[35m (2.0ms)[0m  [1m[35mCREATE  INDEX  "index_surcharges_on_rate_id" ON "surcharges"  ("rate_id")[0m
  [1m[35m (2.8ms)[0m  [1m[35mALTER TABLE "criteria" ADD CONSTRAINT "fk_rails_bdaea3548d"
FOREIGN KEY ("discount_id")
  REFERENCES "discounts" ("id")
[0m
  [1m[35m (1.7ms)[0m  [1m[35mALTER TABLE "discounts" ADD CONSTRAINT "fk_rails_fe59a5d92f"
FOREIGN KEY ("rate_id")
  REFERENCES "rates" ("id")
[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "rates" ADD CONSTRAINT "fk_rails_fa792fbb92"
FOREIGN KEY ("customer_id")
  REFERENCES "customers" ("id")
[0m
  [1m[35m (1.7ms)[0m  [1m[35mALTER TABLE "surcharges" ADD CONSTRAINT "fk_rails_fb43e4bb55"
FOREIGN KEY ("rate_id")
  REFERENCES "rates" ("id")
[0m
  [1m[35m (3.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (6.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20200529231701)[0m
  [1m[35m (12.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20200529214347),
(20200529220013),
(20200529221627),
(20200529222310),
(20200529222841),
(20200529223751),
(20200529224831),
(20200529225234),
(20200529225910),
(20200529230147),
(20200529230733),
(20200529231414);

[0m
  [1m[35m (2.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.6ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "environment"], ["value", "test"], ["created_at", "2020-05-30 19:07:34.832491"], ["updated_at", "2020-05-30 19:07:34.832491"]]
  [1m[35m (6.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "schema_sha1"], ["value", "5484c48bca153f497e1d588c5ab2d9679b12b26f"], ["created_at", "2020-05-30 19:07:34.844346"], ["updated_at", "2020-05-30 19:07:34.844346"]]
  [1m[35m (4.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (109.2ms)[0m  [1m[35mCREATE DATABASE "sec_storage_test-1" ENCODING = 'utf8'[0m
  [1m[35m (114.4ms)[0m  [1m[35mCREATE DATABASE "sec_storage_test-0" ENCODING = 'utf8'[0m
  [1m[35mSQL (0.5ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35mSQL (0.5ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "criteria" CASCADE[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "criteria" CASCADE[0m
  [1m[35m (9.8ms)[0m  [1m[35mCREATE TABLE "criteria" ("id" bigserial primary key, "type" character varying NOT NULL, "start" integer NOT NULL, "end" integer, "discount_id" bigint NOT NULL)[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE  INDEX  "index_criteria_on_discount_id" ON "criteria"  ("discount_id")[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "customers" CASCADE[0m
  [1m[35m (2.8ms)[0m  [1m[35mCREATE TABLE "customers" ("id" bigserial primary key)[0m
  [1m[35m (12.7ms)[0m  [1m[35mCREATE TABLE "criteria" ("id" bigserial primary key, "type" character varying NOT NULL, "start" integer NOT NULL, "end" integer, "discount_id" bigint NOT NULL)[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "discounts" CASCADE[0m
  [1m[35m (4.1ms)[0m  [1m[35mCREATE TABLE "discounts" ("id" bigserial primary key, "is_flat" boolean NOT NULL, "type" character varying, "type_value" integer NOT NULL, "rate_id" bigint NOT NULL)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE  INDEX  "index_criteria_on_discount_id" ON "criteria"  ("discount_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "customers" CASCADE[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE  INDEX  "index_discounts_on_rate_id" ON "discounts"  ("rate_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "rates" CASCADE[0m
  [1m[35m (2.8ms)[0m  [1m[35mCREATE TABLE "customers" ("id" bigserial primary key)[0m
  [1m[35m (0.4ms)[0m  [1m[35mDROP TABLE IF EXISTS "discounts" CASCADE[0m
  [1m[35m (2.4ms)[0m  [1m[35mCREATE TABLE "rates" ("id" bigserial primary key, "customer_id" bigint NOT NULL)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX  "index_rates_on_customer_id" ON "rates"  ("customer_id")[0m
  [1m[35m (3.8ms)[0m  [1m[35mCREATE TABLE "discounts" ("id" bigserial primary key, "is_flat" boolean NOT NULL, "type" character varying, "type_value" integer NOT NULL, "rate_id" bigint NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "surcharges" CASCADE[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX  "index_discounts_on_rate_id" ON "discounts"  ("rate_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "rates" CASCADE[0m
  [1m[35m (3.9ms)[0m  [1m[35mCREATE TABLE "surcharges" ("id" bigserial primary key, "item_property" character varying NOT NULL, "type" character varying NOT NULL, "type_value" integer NOT NULL, "rate_id" bigint NOT NULL)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX  "index_surcharges_on_rate_id" ON "surcharges"  ("rate_id")[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE TABLE "rates" ("id" bigserial primary key, "customer_id" bigint NOT NULL)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX  "index_rates_on_customer_id" ON "rates"  ("customer_id")[0m
  [1m[35m (2.7ms)[0m  [1m[35mALTER TABLE "criteria" ADD CONSTRAINT "fk_rails_bdaea3548d"
FOREIGN KEY ("discount_id")
  REFERENCES "discounts" ("id")
[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "surcharges" CASCADE[0m
  [1m[35m (3.2ms)[0m  [1m[35mALTER TABLE "discounts" ADD CONSTRAINT "fk_rails_fe59a5d92f"
FOREIGN KEY ("rate_id")
  REFERENCES "rates" ("id")
[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "rates" ADD CONSTRAINT "fk_rails_fa792fbb92"
FOREIGN KEY ("customer_id")
  REFERENCES "customers" ("id")
[0m
  [1m[35m (5.3ms)[0m  [1m[35mCREATE TABLE "surcharges" ("id" bigserial primary key, "item_property" character varying NOT NULL, "type" character varying NOT NULL, "type_value" integer NOT NULL, "rate_id" bigint NOT NULL)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE  INDEX  "index_surcharges_on_rate_id" ON "surcharges"  ("rate_id")[0m
  [1m[35m (2.1ms)[0m  [1m[35mALTER TABLE "surcharges" ADD CONSTRAINT "fk_rails_fb43e4bb55"
FOREIGN KEY ("rate_id")
  REFERENCES "rates" ("id")
[0m
  [1m[35m (2.9ms)[0m  [1m[35mALTER TABLE "criteria" ADD CONSTRAINT "fk_rails_bdaea3548d"
FOREIGN KEY ("discount_id")
  REFERENCES "discounts" ("id")
[0m
  [1m[35m (1.7ms)[0m  [1m[35mALTER TABLE "discounts" ADD CONSTRAINT "fk_rails_fe59a5d92f"
FOREIGN KEY ("rate_id")
  REFERENCES "rates" ("id")
[0m
  [1m[35m (1.6ms)[0m  [1m[35mALTER TABLE "rates" ADD CONSTRAINT "fk_rails_fa792fbb92"
FOREIGN KEY ("customer_id")
  REFERENCES "customers" ("id")
[0m
  [1m[35m (1.8ms)[0m  [1m[35mALTER TABLE "surcharges" ADD CONSTRAINT "fk_rails_fb43e4bb55"
FOREIGN KEY ("rate_id")
  REFERENCES "rates" ("id")
[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20200529231701)[0m
  [1m[35m (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20200529214347),
(20200529220013),
(20200529221627),
(20200529222310),
(20200529222841),
(20200529223751),
(20200529224831),
(20200529225234),
(20200529225910),
(20200529230147),
(20200529230733),
(20200529231414);

[0m
  [1m[35m (4.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (3.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (2.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20200529231701)[0m
  [1m[35m (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20200529214347),
(20200529220013),
(20200529221627),
(20200529222310),
(20200529222841),
(20200529223751),
(20200529224831),
(20200529225234),
(20200529225910),
(20200529230147),
(20200529230733),
(20200529231414);

[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.5ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "environment"], ["value", "test"], ["created_at", "2020-05-30 19:12:16.832841"], ["updated_at", "2020-05-30 19:12:16.832841"]]
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "schema_sha1"], ["value", "5484c48bca153f497e1d588c5ab2d9679b12b26f"], ["created_at", "2020-05-30 19:12:16.840987"], ["updated_at", "2020-05-30 19:12:16.840987"]]
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.6ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "environment"], ["value", "test"], ["created_at", "2020-05-30 19:12:16.849601"], ["updated_at", "2020-05-30 19:12:16.849601"]]
  [1m[35m (6.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "schema_sha1"], ["value", "5484c48bca153f497e1d588c5ab2d9679b12b26f"], ["created_at", "2020-05-30 19:12:16.864131"], ["updated_at", "2020-05-30 19:12:16.864131"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
RateTest: test_should_not_save_rate_without_customer_id
-------------------------------------------------------
  [1m[35m (6.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL[0m
  [1m[35m (8.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (9.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (16.0ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (17.6ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
RateTest: test_should_not_save_rate_without_customer_id
-------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (18.7ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (18.2ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
SurchargeTest: test_should_not_save_rate_without_rate_id
--------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.6ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (14.5ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (17.3ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
SurchargeTest: test_should_not_save_rate_without_rate_id
--------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (14.8ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (14.9ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
SurchargeTest: test_should_not_save_rate_without_rate_id
--------------------------------------------------------
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (14.5ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (14.3ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
SurchargeTest: test_should_not_save_rate_without_rate_id
--------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (13.4ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (13.3ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (7.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (6.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (14.9ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (14.6ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
CriterionTest: test_should_not_save_rate_without_discount_id
------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.7ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (15.3ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (15.2ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
CriterionTest: test_should_not_save_rate_without_discount_id
------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (3.4ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (19.4ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (17.1ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
CriteriaTest: test_should_not_save_rate_without_discount_id
-----------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (7.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (4.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (17.7ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (18.3ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
CriteriaTest: test_should_not_save_rate_without_discount_id
-----------------------------------------------------------
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (17.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "environment"]]
  [1m[35m (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "environment"]]
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "environment"]]
  [1m[35m (56.5ms)[0m  [1m[35mDROP DATABASE IF EXISTS "sec_storage_test"[0m
  [1m[35m (283.8ms)[0m  [1m[35mCREATE DATABASE "sec_storage_test" ENCODING = 'utf8'[0m
  [1m[35mSQL (11.5ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.6ms)[0m  [1m[35mDROP TABLE IF EXISTS "criteria" CASCADE[0m
  [1m[35m (44.1ms)[0m  [1m[35mCREATE TABLE "criteria" ("id" bigserial primary key, "criteria_type" character varying NOT NULL, "start" integer NOT NULL, "end" integer, "discount_id" bigint NOT NULL)[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE  INDEX  "index_criteria_on_discount_id" ON "criteria"  ("discount_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "customers" CASCADE[0m
  [1m[35m (2.8ms)[0m  [1m[35mCREATE TABLE "customers" ("id" bigserial primary key)[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "discounts" CASCADE[0m
  [1m[35m (6.9ms)[0m  [1m[35mCREATE TABLE "discounts" ("id" bigserial primary key, "is_flat" boolean NOT NULL, "discount_type" character varying, "type_value" integer NOT NULL, "rate_id" bigint NOT NULL)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX  "index_discounts_on_rate_id" ON "discounts"  ("rate_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "rates" CASCADE[0m
  [1m[35m (4.1ms)[0m  [1m[35mCREATE TABLE "rates" ("id" bigserial primary key, "customer_id" bigint NOT NULL)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX  "index_rates_on_customer_id" ON "rates"  ("customer_id")[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "surcharges" CASCADE[0m
  [1m[35m (5.9ms)[0m  [1m[35mCREATE TABLE "surcharges" ("id" bigserial primary key, "item_property" character varying NOT NULL, "surcharge_type" character varying NOT NULL, "type_value" integer NOT NULL, "rate_id" bigint NOT NULL)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX  "index_surcharges_on_rate_id" ON "surcharges"  ("rate_id")[0m
  [1m[35m (5.6ms)[0m  [1m[35mALTER TABLE "criteria" ADD CONSTRAINT "fk_rails_bdaea3548d"
FOREIGN KEY ("discount_id")
  REFERENCES "discounts" ("id")
[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "discounts" ADD CONSTRAINT "fk_rails_fe59a5d92f"
FOREIGN KEY ("rate_id")
  REFERENCES "rates" ("id")
[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "rates" ADD CONSTRAINT "fk_rails_fa792fbb92"
FOREIGN KEY ("customer_id")
  REFERENCES "customers" ("id")
[0m
  [1m[35m (3.0ms)[0m  [1m[35mALTER TABLE "surcharges" ADD CONSTRAINT "fk_rails_fb43e4bb55"
FOREIGN KEY ("rate_id")
  REFERENCES "rates" ("id")
[0m
  [1m[35m (2.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (6.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20200531185517)[0m
  [1m[35m (18.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20200529214347),
(20200529220013),
(20200529221627),
(20200529222310),
(20200529222841),
(20200529223751),
(20200529224831),
(20200529225234),
(20200529225910),
(20200529230147),
(20200529230733),
(20200529231414),
(20200529231701);

[0m
  [1m[35m (5.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (2.6ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "environment"], ["value", "test"], ["created_at", "2020-06-02 16:13:59.879597"], ["updated_at", "2020-06-02 16:13:59.879597"]]
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "schema_sha1"], ["value", "2ac5b6a9320154528799541b6a3044a9fd8ca222"], ["created_at", "2020-06-02 16:13:59.895498"], ["updated_at", "2020-06-02 16:13:59.895498"]]
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (2.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (1.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (90.9ms)[0m  [1m[35mDROP DATABASE IF EXISTS "sec_storage_test-0"[0m
  [1m[35m (106.1ms)[0m  [1m[35mDROP DATABASE IF EXISTS "sec_storage_test-1"[0m
  [1m[35m (440.3ms)[0m  [1m[35mCREATE DATABASE "sec_storage_test-0" ENCODING = 'utf8'[0m
  [1m[35m (479.2ms)[0m  [1m[35mCREATE DATABASE "sec_storage_test-1" ENCODING = 'utf8'[0m
  [1m[35mSQL (0.5ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.8ms)[0m  [1m[35mDROP TABLE IF EXISTS "criteria" CASCADE[0m
  [1m[35mSQL (0.4ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "criteria" CASCADE[0m
  [1m[35m (42.0ms)[0m  [1m[35mCREATE TABLE "criteria" ("id" bigserial primary key, "criteria_type" character varying NOT NULL, "start" integer NOT NULL, "end" integer, "discount_id" bigint NOT NULL)[0m
  [1m[35m (2.0ms)[0m  [1m[35mCREATE  INDEX  "index_criteria_on_discount_id" ON "criteria"  ("discount_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "customers" CASCADE[0m
  [1m[35m (26.1ms)[0m  [1m[35mCREATE TABLE "criteria" ("id" bigserial primary key, "criteria_type" character varying NOT NULL, "start" integer NOT NULL, "end" integer, "discount_id" bigint NOT NULL)[0m
  [1m[35m (4.4ms)[0m  [1m[35mCREATE TABLE "customers" ("id" bigserial primary key)[0m
  [1m[35m (0.5ms)[0m  [1m[35mDROP TABLE IF EXISTS "discounts" CASCADE[0m
  [1m[35m (2.9ms)[0m  [1m[35mCREATE  INDEX  "index_criteria_on_discount_id" ON "criteria"  ("discount_id")[0m
  [1m[35m (0.5ms)[0m  [1m[35mDROP TABLE IF EXISTS "customers" CASCADE[0m
  [1m[35m (8.1ms)[0m  [1m[35mCREATE TABLE "customers" ("id" bigserial primary key)[0m
  [1m[35m (16.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "discounts" CASCADE[0m
  [1m[35m (39.1ms)[0m  [1m[35mCREATE TABLE "discounts" ("id" bigserial primary key, "is_flat" boolean NOT NULL, "discount_type" character varying, "type_value" integer NOT NULL, "rate_id" bigint NOT NULL)[0m
  [1m[35m (11.2ms)[0m  [1m[35mCREATE TABLE "discounts" ("id" bigserial primary key, "is_flat" boolean NOT NULL, "discount_type" character varying, "type_value" integer NOT NULL, "rate_id" bigint NOT NULL)[0m
  [1m[35m (2.6ms)[0m  [1m[35mCREATE  INDEX  "index_discounts_on_rate_id" ON "discounts"  ("rate_id")[0m
  [1m[35m (2.8ms)[0m  [1m[35mCREATE  INDEX  "index_discounts_on_rate_id" ON "discounts"  ("rate_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "rates" CASCADE[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "rates" CASCADE[0m
  [1m[35m (6.2ms)[0m  [1m[35mCREATE TABLE "rates" ("id" bigserial primary key, "customer_id" bigint NOT NULL)[0m
  [1m[35m (6.2ms)[0m  [1m[35mCREATE TABLE "rates" ("id" bigserial primary key, "customer_id" bigint NOT NULL)[0m
  [1m[35m (2.4ms)[0m  [1m[35mCREATE  INDEX  "index_rates_on_customer_id" ON "rates"  ("customer_id")[0m
  [1m[35m (2.8ms)[0m  [1m[35mCREATE  INDEX  "index_rates_on_customer_id" ON "rates"  ("customer_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "surcharges" CASCADE[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "surcharges" CASCADE[0m
  [1m[35m (9.7ms)[0m  [1m[35mCREATE TABLE "surcharges" ("id" bigserial primary key, "item_property" character varying NOT NULL, "surcharge_type" character varying NOT NULL, "type_value" integer NOT NULL, "rate_id" bigint NOT NULL)[0m
  [1m[35m (10.7ms)[0m  [1m[35mCREATE TABLE "surcharges" ("id" bigserial primary key, "item_property" character varying NOT NULL, "surcharge_type" character varying NOT NULL, "type_value" integer NOT NULL, "rate_id" bigint NOT NULL)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX  "index_surcharges_on_rate_id" ON "surcharges"  ("rate_id")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX  "index_surcharges_on_rate_id" ON "surcharges"  ("rate_id")[0m
  [1m[35m (5.5ms)[0m  [1m[35mALTER TABLE "criteria" ADD CONSTRAINT "fk_rails_bdaea3548d"
FOREIGN KEY ("discount_id")
  REFERENCES "discounts" ("id")
[0m
  [1m[35m (5.3ms)[0m  [1m[35mALTER TABLE "criteria" ADD CONSTRAINT "fk_rails_bdaea3548d"
FOREIGN KEY ("discount_id")
  REFERENCES "discounts" ("id")
[0m
  [1m[35m (3.0ms)[0m  [1m[35mALTER TABLE "discounts" ADD CONSTRAINT "fk_rails_fe59a5d92f"
FOREIGN KEY ("rate_id")
  REFERENCES "rates" ("id")
[0m
  [1m[35m (3.2ms)[0m  [1m[35mALTER TABLE "discounts" ADD CONSTRAINT "fk_rails_fe59a5d92f"
FOREIGN KEY ("rate_id")
  REFERENCES "rates" ("id")
[0m
  [1m[35m (2.9ms)[0m  [1m[35mALTER TABLE "rates" ADD CONSTRAINT "fk_rails_fa792fbb92"
FOREIGN KEY ("customer_id")
  REFERENCES "customers" ("id")
[0m
  [1m[35m (3.1ms)[0m  [1m[35mALTER TABLE "rates" ADD CONSTRAINT "fk_rails_fa792fbb92"
FOREIGN KEY ("customer_id")
  REFERENCES "customers" ("id")
[0m
  [1m[35m (2.1ms)[0m  [1m[35mALTER TABLE "surcharges" ADD CONSTRAINT "fk_rails_fb43e4bb55"
FOREIGN KEY ("rate_id")
  REFERENCES "rates" ("id")
[0m
  [1m[35m (2.8ms)[0m  [1m[35mALTER TABLE "surcharges" ADD CONSTRAINT "fk_rails_fb43e4bb55"
FOREIGN KEY ("rate_id")
  REFERENCES "rates" ("id")
[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20200531185517)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20200531185517)[0m
  [1m[35m (2.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20200529214347),
(20200529220013),
(20200529221627),
(20200529222310),
(20200529222841),
(20200529223751),
(20200529224831),
(20200529225234),
(20200529225910),
(20200529230147),
(20200529230733),
(20200529231414),
(20200529231701);

[0m
  [1m[35m (2.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20200529214347),
(20200529220013),
(20200529221627),
(20200529222310),
(20200529222841),
(20200529223751),
(20200529224831),
(20200529225234),
(20200529225910),
(20200529230147),
(20200529230733),
(20200529231414),
(20200529231701);

[0m
  [1m[35m (5.5ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (7.6ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.7ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "environment"], ["value", "test"], ["created_at", "2020-06-02 16:14:00.905657"], ["updated_at", "2020-06-02 16:14:00.905657"]]
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.6ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "environment"], ["value", "test"], ["created_at", "2020-06-02 16:14:00.909343"], ["updated_at", "2020-06-02 16:14:00.909343"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "schema_sha1"], ["value", "2ac5b6a9320154528799541b6a3044a9fd8ca222"], ["created_at", "2020-06-02 16:14:00.913656"], ["updated_at", "2020-06-02 16:14:00.913656"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "schema_sha1"], ["value", "2ac5b6a9320154528799541b6a3044a9fd8ca222"], ["created_at", "2020-06-02 16:14:00.917800"], ["updated_at", "2020-06-02 16:14:00.917800"]]
  [1m[35m (5.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------------
RateTest: test_should_not_save_rate_with_customer_id_that_doesn't_reference_an_existing_customer
------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
RateTest: test_should_not_save_rate_without_customer_id
-------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (15.4ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (17.0ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (2.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------------
RateTest: test_should_not_save_rate_with_customer_id_that_doesn't_reference_an_existing_customer
------------------------------------------------------------------------------------------------
  [1m[35m (0.6ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
RateTest: test_should_not_save_rate_without_customer_id
-------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (8.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (6.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (11.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (31.6ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (36.8ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (8.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------------
RateTest: test_should_not_save_rate_with_customer_id_that_doesn't_reference_an_existing_customer
------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
RateTest: test_should_not_save_rate_without_customer_id
-------------------------------------------------------
  [1m[35m (5.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCustomer Load (0.4ms)[0m  [1m[34mSELECT "customers".* FROM "customers" WHERE "customers"."id" = $1 LIMIT $2[0m  [["id", 10], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (6.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (5.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (3.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (17.6ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (17.8ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.6ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------------------------
RateTest: test_should_not_save_rate_with_customer_id_that_doesn't_reference_an_existing_customer
------------------------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
RateTest: test_should_not_save_rate_without_customer_id
-------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCustomer Load (0.6ms)[0m  [1m[34mSELECT "customers".* FROM "customers" WHERE "customers"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (2.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (17.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (15.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (51.1ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (52.5ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
RateTest: test_should_not_save_rate_without_customer_id
-----------------------------------------------------------------
-------------------------------------------------------
RateTest: test_should_not_save_rate_with_a_non_unique_customer_id
-----------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mCustomer Load (0.7ms)[0m  [1m[34mSELECT "customers".* FROM "customers" WHERE "customers"."id" = $1 LIMIT $2[0m  [["id", 10], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (15.9ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (17.5ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
RateTest: test_should_not_save_rate_with_a_non_unique_customer_id
-----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
RateTest: test_should_not_save_rate_with_an_invalid_customer_id
---------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCustomer Load (0.6ms)[0m  [1m[34mSELECT "customers".* FROM "customers" WHERE "customers"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mCustomer Load (10.3ms)[0m  [1m[34mSELECT "customers".* FROM "customers" WHERE "customers"."id" = $1 LIMIT $2[0m  [["id", 100], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
RateTest: test_should_not_save_rate_without_customer_id
-------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (5.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (8.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (28.7ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (23.5ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (7.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (7.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
RateTest: test_should_not_save_rate_with_an_invalid_customer_id
---------------------------------------------------------------
-------------------------------------------------------
RateTest: test_should_not_save_rate_without_customer_id
-------------------------------------------------------
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mCustomer Load (0.6ms)[0m  [1m[34mSELECT "customers".* FROM "customers" WHERE "customers"."id" = $1 LIMIT $2[0m  [["id", 10000], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (2.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (15.3ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (13.3ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (1.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.6ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (14.9ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (15.2ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (7.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (4.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (16.9ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (17.1ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mRate Load (0.8ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 10000], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (16.9ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (21.6ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.1ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
DiscountTest: test_is_flat?_attribute_must_have_boolean_value
-------------------------------------------------------------
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
  [1m[36mRate Load (0.5ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 0], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mRate Load (0.5ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 10000], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (1.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (19.8ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (19.0ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (2.8ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.1ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1051557316, 1)[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1051557316, 1)[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_is_flat?_attribute_must_have_a_boolean_value
---------------------------------------------------------------
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
DiscountTest: test_type_value_attribute_must_be_an_integer_value
----------------------------------------------------------------
  [1m[36mRate Load (0.5ms)[0m  [1m[34mSELECT "rates".* FROM "rates" ORDER BY "rates"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (8.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (8.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (39.9ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (41.4ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1051557316, 1)[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1051557316, 1)[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_is_flat?_attribute_must_have_a_boolean_value
---------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.5ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (3.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (14.9ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (15.3ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.5ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (6.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1051557316, 1)[0m
  [1m[35m (8.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (3.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1051557316, 1)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_is_flat?_attribute_must_have_a_boolean_value
---------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 0], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 10000], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.8ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (8.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (8.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (15.6ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (16.4ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1051557316, 1)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1051557316, 1)[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_is_flat?_attribute_must_have_a_boolean_value
---------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.7ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (15.2ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (17.4ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (6.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1051557316, 1)[0m
  [1m[35m (10.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (2.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1051557316, 1)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_is_flat?_attribute_must_have_a_boolean_value
---------------------------------------------------------------
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.5ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (8.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (7.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (17.3ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (18.0ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1051557316, 1)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1051557316, 1)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_is_flat?_attribute_must_have_a_boolean_value
---------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.7ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (13.7ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (12.3ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (6.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1051557316, 1)[0m
  [1m[35m (5.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (3.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1051557316, 1)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_is_flat?_attribute_must_have_a_boolean_value
---------------------------------------------------------------
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (17.1ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (17.0ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.0ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1051557316, 1)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" ORDER BY "rates"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1051557316], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (2.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.6ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (20.6ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (21.0ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.7ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1051557316, 1)[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[36mRate Load (0.4ms)[0m  [1m[34mSELECT "rates".* FROM "rates" ORDER BY "rates"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1051557316], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (1.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (13.5ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (14.0ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (6.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1051557316, 1)[0m
  [1m[35m (4.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.5ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (1.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (2.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (6.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (17.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (30.9ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (19.9ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (6.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1051557316, 1)[0m
  [1m[35m (4.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (12.5ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (12.8ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (6.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1051557316, 1)[0m
  [1m[35m (11.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (5.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.4ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (13.0ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (13.5ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (12.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1051557316, 1)[0m
  [1m[35m (10.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.7ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (16.6ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (17.8ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (186.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (17.5ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (11.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (6.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
------------
Test: test_d
------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCustomer Create (0.6ms)[0m  [1m[32mINSERT INTO "customers" DEFAULT VALUES RETURNING "id"[0m
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (63.4ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (7.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (7.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (14.6ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (14.4ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------
Test: test_d
------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mCustomer Create (0.6ms)[0m  [1m[32mINSERT INTO "customers" DEFAULT VALUES RETURNING "id"[0m
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.7ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (3.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (18.0ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (18.1ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (6.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mDiscount Create (1.3ms)[0m  [1m[32mINSERT INTO "discounts" ("is_flat", "discount_type", "type_value", "rate_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["is_flat", true], ["discount_type", "percentage"], ["type_value", 10], ["rate_id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (2.5ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (18.9ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (20.5ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mDiscount Create (1.5ms)[0m  [1m[32mINSERT INTO "discounts" ("is_flat", "discount_type", "type_value", "rate_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["is_flat", true], ["discount_type", "percentage"], ["type_value", 10], ["rate_id", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (1.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (2.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (13.7ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (13.7ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (7.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (7.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.6ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (1.8ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 10000], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (3.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (2.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (13.7ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (13.9ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 10000], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (8.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (8.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (19.5ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (19.9ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (2.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (4.6ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (3.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_is_flat?_attribute_must_have_a_boolean_value
---------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 10000], ["LIMIT", 1]]
  [1m[35m (1.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDiscount Create (4.5ms)[0m  [1m[32mINSERT INTO "discounts" ("is_flat", "discount_type", "type_value", "rate_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["is_flat", true], ["discount_type", "percentage"], ["type_value", 10], ["rate_id", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (5.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.5ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (14.1ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (12.1ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (2.5ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_is_flat?_attribute_must_have_a_boolean_value
---------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 10000], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mDiscount Create (1.2ms)[0m  [1m[32mINSERT INTO "discounts" ("is_flat", "discount_type", "type_value", "rate_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["is_flat", true], ["discount_type", "percentage"], ["type_value", 10], ["rate_id", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.6ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (14.8ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (15.4ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 10000], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (12.7ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (12.5ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
DiscountTest: test_is_flat?_attribute_must_have_a_boolean_value
---------------------------------------------------------------
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDiscount Create (1.5ms)[0m  [1m[32mINSERT INTO "discounts" ("is_flat", "discount_type", "type_value", "rate_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["is_flat", true], ["discount_type", "percentage"], ["type_value", 10], ["rate_id", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (15.5ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (15.6ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.6ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_is_flat?_attribute_must_have_a_boolean_value
---------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mDiscount Create (1.3ms)[0m  [1m[32mINSERT INTO "discounts" ("is_flat", "discount_type", "type_value", "rate_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["is_flat", true], ["discount_type", "percentage"], ["type_value", 10], ["rate_id", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.6ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (12.8ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (13.5ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_is_flat?_attribute_must_have_a_boolean_value
---------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDiscount Create (1.1ms)[0m  [1m[32mINSERT INTO "discounts" ("is_flat", "discount_type", "type_value", "rate_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["is_flat", true], ["discount_type", "percentage"], ["type_value", 10], ["rate_id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (13.8ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.6ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (17.5ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (5.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (2.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
DiscountTest: test_type_value_attribute_must_be_a_positive_integer
------------------------------------------------------------------
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (1.9ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mDiscount Create (1.0ms)[0m  [1m[32mINSERT INTO "discounts" ("is_flat", "discount_type", "type_value", "rate_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["is_flat", true], ["discount_type", "percentage"], ["type_value", 10], ["rate_id", 1]]
  [1m[36mDiscount Create (1.1ms)[0m  [1m[32mINSERT INTO "discounts" ("is_flat", "discount_type", "type_value", "rate_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["is_flat", true], ["discount_type", "percentage"], ["type_value", -1], ["rate_id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 10000], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (1.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (14.8ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (13.1ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 10000], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
DiscountTest: test_type_value_attribute_must_be_a_positive_integer
------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mDiscount Create (1.2ms)[0m  [1m[32mINSERT INTO "discounts" ("is_flat", "discount_type", "type_value", "rate_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["is_flat", true], ["discount_type", "percentage"], ["type_value", -1], ["rate_id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (13.0ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (14.0ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
DiscountTest: test_type_value_attribute_must_be_a_positive_integer
------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (2.2ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (8.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (7.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (15.6ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (15.5ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
DiscountTest: test_type_value_attribute_must_be_a_positive_integer
------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 10000], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDiscount Create (1.0ms)[0m  [1m[32mINSERT INTO "discounts" ("is_flat", "discount_type", "type_value", "rate_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["is_flat", true], ["discount_type", "percentage"], ["type_value", 1], ["rate_id", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (14.3ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (14.0ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 10000], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
DiscountTest: test_type_value_attribute_must_be_a_positive_integer
------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mDiscount Create (5.6ms)[0m  [1m[32mINSERT INTO "discounts" ("is_flat", "discount_type", "type_value", "rate_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["is_flat", true], ["discount_type", "percentage"], ["type_value", 1], ["rate_id", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (1.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (15.6ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (15.4ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
------------------------------------------------------------------
---------------------------------------------------------------
DiscountTest: test_type_value_attribute_must_be_a_positive_integer
------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 10000], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.4ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDiscount Create (1.5ms)[0m  [1m[32mINSERT INTO "discounts" ("is_flat", "discount_type", "type_value", "rate_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["is_flat", true], ["discount_type", "percentage"], ["type_value", 1], ["rate_id", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.6ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (18.3ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (15.1ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.7ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (4.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 10000], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
DiscountTest: test_type_value_attribute_must_be_a_positive_integer
------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.6ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (14.3ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (14.2ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.6ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
DiscountTest: test_type_value_attribute_must_be_a_positive_integer
------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 10000], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (8.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (5.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (15.3ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (15.4ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.5ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (2.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
DiscountTest: test_type_value_attribute_must_be_a_positive_integer
-------------------------------------------------------
------------------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 10000], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (13.6ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (14.6ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.7ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (3.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (2.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
DiscountTest: test_type_value_attribute_must_be_a_positive_integer
------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mRate Load (0.4ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 10000], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (1.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.7ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (4.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (19.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (22.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (42.1ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (36.2ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.6ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (5.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (5.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.6ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (1.9ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
DiscountTest: test_should_not_save_rate_without_rate_id
---------------------------------------------------------------
-------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 10000], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
DiscountTest: test_type_value_attribute_must_be_a_positive_integer
------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (13.5ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (14.7ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (6.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (3.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (10.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 10000], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------
DiscountTest: test_discount_type_attribute_must_be_'percentage'_or_'monetary'
-----------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
DiscountTest: test_type_value_attribute_must_be_a_positive_integer
------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.7ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (12.8ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (13.0ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
DiscountTest: test_type_value_attribute_must_be_a_positive_integer
------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 10000], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------
DiscountTest: test_discount_type_attribute_must_be_'percentage'_or_'monetary'
-----------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (2.0ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (12.2ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (12.1ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.7ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------
DiscountTest: test_discount_type_attribute_must_be_'percentage'_or_'monetary'
-----------------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
DiscountTest: test_type_value_attribute_must_be_a_positive_integer
------------------------------------------------------------------
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 10000], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (12.8ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (13.0ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
-----------------------------------------------------------------------------
DiscountTest: test_discount_type_attribute_must_be_'percentage'_or_'monetary'
-----------------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 10000], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
DiscountTest: test_type_value_attribute_must_be_a_positive_integer
------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (13.9ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.6ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (14.2ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
DiscountTest: test_type_value_attribute_must_be_a_positive_integer
------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 10000], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (7.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (7.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (13.6ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (13.4ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 10000], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
DiscountTest: test_type_value_attribute_must_be_a_positive_integer
------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (12.5ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (12.8ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
  [1m[35m (0.6ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 10000], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
DiscountTest: test_type_value_attribute_must_be_a_positive_integer
------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (8.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (8.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (13.0ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (14.4ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
DiscountTest: test_type_value_attribute_must_be_a_positive_integer
------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 10000], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.8ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (13.3ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (16.2ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.8ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
DiscountTest: test_type_value_attribute_must_be_a_positive_integer
------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 10000], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mDiscount Create (1.3ms)[0m  [1m[32mINSERT INTO "discounts" ("is_flat", "discount_type", "type_value", "rate_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["is_flat", true], ["discount_type", "percentage"], ["type_value", 1], ["rate_id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (14.6ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (15.2ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 10000], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
DiscountTest: test_type_value_attribute_must_be_a_positive_integer
------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mRate Load (0.8ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mDiscount Create (1.2ms)[0m  [1m[32mINSERT INTO "discounts" ("is_flat", "discount_type", "type_value", "rate_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["is_flat", true], ["discount_type", "monetary"], ["type_value", 1], ["rate_id", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.7ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (12.1ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (12.5ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.6ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
DiscountTest: test_type_value_attribute_must_be_a_positive_integer
------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 10000], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.7ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (8.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (7.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (14.1ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (14.4ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (3.1ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
DiscountTest: test_type_value_attribute_must_be_a_positive_integer
------------------------------------------------------------------
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 10000], ["LIMIT", 1]]
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (15.3ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (16.0ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "rates";
INSERT INTO "rates" ("id", "customer_id") VALUES (1, 1)[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
DiscountTest: test_type_value_attribute_must_be_a_positive_integer
------------------------------------------------------------------
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 10000], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.4ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------
DiscountTest: test_discount_type_attribute_must_be_'percentage'_or_'monetary'
-----------------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (1.0ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.8ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (19.2ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (18.1ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (2.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (5.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.6ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (1.6ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
---------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------
DiscountTest: test_discount_type_attribute_must_be_'percentage'_or_'monetary'
-----------------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.4ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 10000], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
------------------------------------------------------------------
-------------------------------------------------------
DiscountTest: test_type_value_attribute_must_be_a_positive_integer
------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.7ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (15.5ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (16.7ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (6.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (3.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
CriteriaTest: test_should_not_save_rate_without_discount_id
-----------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (15.8ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (14.3ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.2ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
CriteriaTest: test_should_not_save_rate_without_discount_id
-----------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (14.5ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (15.6ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
CriteriaTest: test_should_not_save_rate_without_discount_id
-----------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.9ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (12.8ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (14.1ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
SurchargeTest: test_should_not_save_rate_without_rate_id
--------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (13.2ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (13.5ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
SurchargeTest: test_should_not_save_rate_without_discount_id
------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (12.4ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (14.4ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
SurchargeTest: test_should_not_save_rate_without_rate_id
--------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (14.8ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (14.9ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.8ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
SurchargeTest: test_should_not_save_rate_without_rate_id
--------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (13.3ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (12.9ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
SurchargeTest: test_should_not_save_rate_without_rate_id
--------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "environment"]]
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "environment"]]
  [1m[35m (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "environment"]]
  [1m[35m (33.7ms)[0m  [1m[35mDROP DATABASE IF EXISTS "sec_storage_test"[0m
  [1m[35m (271.6ms)[0m  [1m[35mCREATE DATABASE "sec_storage_test" ENCODING = 'utf8'[0m
  [1m[35mSQL (0.9ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.6ms)[0m  [1m[35mDROP TABLE IF EXISTS "criteria" CASCADE[0m
  [1m[35m (11.6ms)[0m  [1m[35mCREATE TABLE "criteria" ("id" bigserial primary key, "criteria_type" character varying NOT NULL, "start" integer NOT NULL, "end" integer, "discount_id" bigint NOT NULL)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX  "index_criteria_on_discount_id" ON "criteria"  ("discount_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "customers" CASCADE[0m
  [1m[35m (2.1ms)[0m  [1m[35mCREATE TABLE "customers" ("id" bigserial primary key)[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "discounts" CASCADE[0m
  [1m[35m (4.4ms)[0m  [1m[35mCREATE TABLE "discounts" ("id" bigserial primary key, "is_flat" boolean NOT NULL, "discount_type" character varying, "type_value" integer NOT NULL, "rate_id" bigint NOT NULL)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX  "index_discounts_on_rate_id" ON "discounts"  ("rate_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "rates" CASCADE[0m
  [1m[35m (2.5ms)[0m  [1m[35mCREATE TABLE "rates" ("id" bigserial primary key, "customer_id" bigint NOT NULL)[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE  INDEX  "index_rates_on_customer_id" ON "rates"  ("customer_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "surcharges" CASCADE[0m
  [1m[35m (3.1ms)[0m  [1m[35mCREATE TABLE "surcharges" ("id" bigserial primary key, "item_property" character varying NOT NULL, "surcharge_type" character varying NOT NULL, "type_value" integer NOT NULL, "rate_id" bigint NOT NULL)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX  "index_surcharges_on_rate_id" ON "surcharges"  ("rate_id")[0m
  [1m[35m (4.2ms)[0m  [1m[35mALTER TABLE "criteria" ADD CONSTRAINT "fk_rails_bdaea3548d"
FOREIGN KEY ("discount_id")
  REFERENCES "discounts" ("id")
[0m
  [1m[35m (1.9ms)[0m  [1m[35mALTER TABLE "discounts" ADD CONSTRAINT "fk_rails_fe59a5d92f"
FOREIGN KEY ("rate_id")
  REFERENCES "rates" ("id")
[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "rates" ADD CONSTRAINT "fk_rails_fa792fbb92"
FOREIGN KEY ("customer_id")
  REFERENCES "customers" ("id")
[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "surcharges" ADD CONSTRAINT "fk_rails_fb43e4bb55"
FOREIGN KEY ("rate_id")
  REFERENCES "rates" ("id")
[0m
  [1m[35m (3.2ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20200531185517)[0m
  [1m[35m (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20200529214347),
(20200529220013),
(20200529221627),
(20200529222310),
(20200529222841),
(20200529223751),
(20200529224831),
(20200529225234),
(20200529225910),
(20200529230147),
(20200529230733),
(20200529231414),
(20200529231701);

[0m
  [1m[35m (3.1ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (1.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "environment"], ["value", "test"], ["created_at", "2020-06-02 19:05:11.026256"], ["updated_at", "2020-06-02 19:05:11.026256"]]
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "schema_sha1"], ["value", "49da0a84ac79c494ef421dbf3b6ef1f90842cb0f"], ["created_at", "2020-06-02 19:05:11.042127"], ["updated_at", "2020-06-02 19:05:11.042127"]]
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (46.1ms)[0m  [1m[35mDROP DATABASE IF EXISTS "sec_storage_test-1"[0m
  [1m[35m (39.8ms)[0m  [1m[35mDROP DATABASE IF EXISTS "sec_storage_test-0"[0m
  [1m[35m (196.3ms)[0m  [1m[35mCREATE DATABASE "sec_storage_test-0" ENCODING = 'utf8'[0m
  [1m[35m (201.3ms)[0m  [1m[35mCREATE DATABASE "sec_storage_test-1" ENCODING = 'utf8'[0m
  [1m[35mSQL (0.4ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35mSQL (0.4ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "criteria" CASCADE[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "criteria" CASCADE[0m
  [1m[35m (6.5ms)[0m  [1m[35mCREATE TABLE "criteria" ("id" bigserial primary key, "criteria_type" character varying NOT NULL, "start" integer NOT NULL, "end" integer, "discount_id" bigint NOT NULL)[0m
  [1m[35m (12.9ms)[0m  [1m[35mCREATE TABLE "criteria" ("id" bigserial primary key, "criteria_type" character varying NOT NULL, "start" integer NOT NULL, "end" integer, "discount_id" bigint NOT NULL)[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE  INDEX  "index_criteria_on_discount_id" ON "criteria"  ("discount_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "customers" CASCADE[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE  INDEX  "index_criteria_on_discount_id" ON "criteria"  ("discount_id")[0m
  [1m[35m (4.0ms)[0m  [1m[35mCREATE TABLE "customers" ("id" bigserial primary key)[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "customers" CASCADE[0m
  [1m[35m (0.4ms)[0m  [1m[35mDROP TABLE IF EXISTS "discounts" CASCADE[0m
  [1m[35m (5.2ms)[0m  [1m[35mCREATE TABLE "customers" ("id" bigserial primary key)[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "discounts" CASCADE[0m
  [1m[35m (6.9ms)[0m  [1m[35mCREATE TABLE "discounts" ("id" bigserial primary key, "is_flat" boolean NOT NULL, "discount_type" character varying, "type_value" integer NOT NULL, "rate_id" bigint NOT NULL)[0m
  [1m[35m (3.8ms)[0m  [1m[35mCREATE TABLE "discounts" ("id" bigserial primary key, "is_flat" boolean NOT NULL, "discount_type" character varying, "type_value" integer NOT NULL, "rate_id" bigint NOT NULL)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX  "index_discounts_on_rate_id" ON "discounts"  ("rate_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "rates" CASCADE[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX  "index_discounts_on_rate_id" ON "discounts"  ("rate_id")[0m
  [1m[35m (2.4ms)[0m  [1m[35mCREATE TABLE "rates" ("id" bigserial primary key, "customer_id" bigint NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "rates" CASCADE[0m
  [1m[35m (2.5ms)[0m  [1m[35mCREATE TABLE "rates" ("id" bigserial primary key, "customer_id" bigint NOT NULL)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE  INDEX  "index_rates_on_customer_id" ON "rates"  ("customer_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "surcharges" CASCADE[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX  "index_rates_on_customer_id" ON "rates"  ("customer_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "surcharges" CASCADE[0m
  [1m[35m (3.1ms)[0m  [1m[35mCREATE TABLE "surcharges" ("id" bigserial primary key, "item_property" character varying NOT NULL, "surcharge_type" character varying NOT NULL, "type_value" integer NOT NULL, "rate_id" bigint NOT NULL)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX  "index_surcharges_on_rate_id" ON "surcharges"  ("rate_id")[0m
  [1m[35m (3.7ms)[0m  [1m[35mCREATE TABLE "surcharges" ("id" bigserial primary key, "item_property" character varying NOT NULL, "surcharge_type" character varying NOT NULL, "type_value" integer NOT NULL, "rate_id" bigint NOT NULL)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX  "index_surcharges_on_rate_id" ON "surcharges"  ("rate_id")[0m
  [1m[35m (3.2ms)[0m  [1m[35mALTER TABLE "criteria" ADD CONSTRAINT "fk_rails_bdaea3548d"
FOREIGN KEY ("discount_id")
  REFERENCES "discounts" ("id")
[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "discounts" ADD CONSTRAINT "fk_rails_fe59a5d92f"
FOREIGN KEY ("rate_id")
  REFERENCES "rates" ("id")
[0m
  [1m[35m (2.6ms)[0m  [1m[35mALTER TABLE "criteria" ADD CONSTRAINT "fk_rails_bdaea3548d"
FOREIGN KEY ("discount_id")
  REFERENCES "discounts" ("id")
[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "rates" ADD CONSTRAINT "fk_rails_fa792fbb92"
FOREIGN KEY ("customer_id")
  REFERENCES "customers" ("id")
[0m
  [1m[35m (1.6ms)[0m  [1m[35mALTER TABLE "discounts" ADD CONSTRAINT "fk_rails_fe59a5d92f"
FOREIGN KEY ("rate_id")
  REFERENCES "rates" ("id")
[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "surcharges" ADD CONSTRAINT "fk_rails_fb43e4bb55"
FOREIGN KEY ("rate_id")
  REFERENCES "rates" ("id")
[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "rates" ADD CONSTRAINT "fk_rails_fa792fbb92"
FOREIGN KEY ("customer_id")
  REFERENCES "customers" ("id")
[0m
  [1m[35m (1.9ms)[0m  [1m[35mALTER TABLE "surcharges" ADD CONSTRAINT "fk_rails_fb43e4bb55"
FOREIGN KEY ("rate_id")
  REFERENCES "rates" ("id")
[0m
  [1m[35m (3.7ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (3.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20200531185517)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20200529214347),
(20200529220013),
(20200529221627),
(20200529222310),
(20200529222841),
(20200529223751),
(20200529224831),
(20200529225234),
(20200529225910),
(20200529230147),
(20200529230733),
(20200529231414),
(20200529231701);

[0m
  [1m[35m (1.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20200531185517)[0m
  [1m[35m (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20200529214347),
(20200529220013),
(20200529221627),
(20200529222310),
(20200529222841),
(20200529223751),
(20200529224831),
(20200529225234),
(20200529225910),
(20200529230147),
(20200529230733),
(20200529231414),
(20200529231701);

[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (4.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.6ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "environment"], ["value", "test"], ["created_at", "2020-06-02 19:05:11.599207"], ["updated_at", "2020-06-02 19:05:11.599207"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.5ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "environment"], ["value", "test"], ["created_at", "2020-06-02 19:05:11.602869"], ["updated_at", "2020-06-02 19:05:11.602869"]]
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::InternalMetadata Load (1.3ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "schema_sha1"], ["value", "49da0a84ac79c494ef421dbf3b6ef1f90842cb0f"], ["created_at", "2020-06-02 19:05:11.609661"], ["updated_at", "2020-06-02 19:05:11.609661"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.6ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "schema_sha1"], ["value", "49da0a84ac79c494ef421dbf3b6ef1f90842cb0f"], ["created_at", "2020-06-02 19:05:11.609661"], ["updated_at", "2020-06-02 19:05:11.609661"]]
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL[0m
  [1m[35m (6.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
SurchargeTest: test_should_not_save_rate_without_rate_id
--------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (1.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL[0m
  [1m[35m (1.7ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL[0m
  [1m[35m (6.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (4.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (17.4ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (17.4ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (4.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
SurchargeTest: test_should_not_save_rate_without_rate_id
--------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mSurcharge Create (1.3ms)[0m  [1m[32mINSERT INTO "surcharges" ("item_property", "surcharge_type", "type_value", "rate_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["item_property", "volume"], ["surcharge_type", "monetary"], ["type_value", 5], ["rate_id", 2]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (8.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (8.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (15.5ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (16.5ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (6.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (14.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
SurchargeTest: test_should_not_save_rate_without_rate_id
--------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (12.5ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (14.6ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (5.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
SurchargeTest: test_should_not_save_rate_without_rate_id
--------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mSurcharge Create (1.0ms)[0m  [1m[32mINSERT INTO "surcharges" ("item_property", "surcharge_type", "type_value", "rate_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["item_property", "volume"], ["surcharge_type", "monetary"], ["type_value", 5], ["rate_id", 2]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (7.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (6.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (43.4ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (43.4ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (6.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
SurchargeTest: test_should_not_save_rate_without_rate_id
--------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mSurcharge Create (1.2ms)[0m  [1m[32mINSERT INTO "surcharges" ("item_property", "surcharge_type", "type_value", "rate_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["item_property", "volume"], ["surcharge_type", "monetary"], ["type_value", 5], ["rate_id", 2]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (1.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (14.1ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (15.4ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (6.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (11.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
SurchargeTest: test_should_not_save_rate_without_rate_id
--------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mSurcharge Create (1.1ms)[0m  [1m[32mINSERT INTO "surcharges" ("item_property", "surcharge_type", "type_value", "rate_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["item_property", "volume"], ["surcharge_type", "monetary"], ["type_value", 5], ["rate_id", 2]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (12.9ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (12.7ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (11.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (22.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (9.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (4.2ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (8.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (10.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (16.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
SurchargeTest: test_should_not_save_rate_with_an_invalid_rate_id
----------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
SurchargeTest: test_should_not_save_rate_without_rate_id
--------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1000], ["LIMIT", 1]]
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mSurcharge Create (1.2ms)[0m  [1m[32mINSERT INTO "surcharges" ("item_property", "surcharge_type", "type_value", "rate_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["item_property", "volume"], ["surcharge_type", "monetary"], ["type_value", 5], ["rate_id", 2]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (12.2ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (12.6ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
SurchargeTest: test_should_not_save_rate_without_rate_id
--------------------------------------------------------
----------------------------------------------------------------
SurchargeTest: test_should_not_save_rate_with_an_invalid_rate_id
----------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1000], ["LIMIT", 1]]
  [1m[36mSurcharge Create (1.0ms)[0m  [1m[32mINSERT INTO "surcharges" ("item_property", "surcharge_type", "type_value", "rate_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["item_property", "volume"], ["surcharge_type", "monetary"], ["type_value", 5], ["rate_id", 2]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
SurchargeTest: test_type_value_attribute_must_be_a_positive_integer
-------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mSurcharge Create (0.5ms)[0m  [1m[32mINSERT INTO "surcharges" ("item_property", "surcharge_type", "type_value", "rate_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["item_property", "volume"], ["surcharge_type", "monetary"], ["type_value", 5], ["rate_id", 2]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.7ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.6ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (16.9ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (14.8ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
SurchargeTest: test_should_not_save_rate_without_rate_id
--------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
SurchargeTest: test_type_value_attribute_must_be_a_positive_integer
-------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.9ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mSurcharge Create (0.9ms)[0m  [1m[32mINSERT INTO "surcharges" ("item_property", "surcharge_type", "type_value", "rate_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["item_property", "volume"], ["surcharge_type", "monetary"], ["type_value", 5], ["rate_id", 2]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
SurchargeTest: test_should_not_save_rate_with_an_invalid_rate_id
----------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1000], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (11.8ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (14.9ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------
SurchargeTest: test_discount_type_attribute_must_be_'percentage'_or_'monetary'
------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
SurchargeTest: test_should_not_save_rate_without_rate_id
--------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
SurchargeTest: test_type_value_attribute_must_be_a_positive_integer
-------------------------------------------------------------------
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
SurchargeTest: test_should_not_save_rate_with_an_invalid_rate_id
----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1000], ["LIMIT", 1]]
  [1m[36mSurcharge Create (1.0ms)[0m  [1m[32mINSERT INTO "surcharges" ("item_property", "surcharge_type", "type_value", "rate_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["item_property", "volume"], ["surcharge_type", "monetary"], ["type_value", 5], ["rate_id", 2]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (1.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (2.5ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (14.5ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (15.6ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------
SurchargeTest: test_discount_type_attribute_must_be_'percentage'_or_'monetary'
------------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
SurchargeTest: test_should_not_save_rate_with_an_invalid_rate_id
----------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1000], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mSurcharge Create (1.2ms)[0m  [1m[32mINSERT INTO "surcharges" ("item_property", "surcharge_type", "type_value", "rate_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["item_property", "volume"], ["surcharge_type", "monetary"], ["type_value", 5], ["rate_id", 2]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
SurchargeTest: test_should_not_save_rate_without_rate_id
--------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
SurchargeTest: test_type_value_attribute_must_be_a_positive_integer
-------------------------------------------------------------------
  [1m[35m (1.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mSurcharge Create (1.2ms)[0m  [1m[32mINSERT INTO "surcharges" ("item_property", "surcharge_type", "type_value", "rate_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["item_property", "volume"], ["surcharge_type", "monetary"], ["type_value", 5], ["rate_id", 2]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (12.5ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (13.8ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
SurchargeTest: test_should_not_save_rate_with_an_invalid_rate_id
----------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------
SurchargeTest: test_discount_type_attribute_must_be_'percentage'_or_'monetary'
------------------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1000], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
SurchargeTest: test_type_value_attribute_must_be_a_positive_integer
-------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
SurchargeTest: test_should_not_save_rate_without_rate_id
--------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mSurcharge Create (1.2ms)[0m  [1m[32mINSERT INTO "surcharges" ("item_property", "surcharge_type", "type_value", "rate_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["item_property", "volume"], ["surcharge_type", "monetary"], ["type_value", 5], ["rate_id", 2]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (13.1ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (13.7ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (1.2ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
----------------------------------------------------------------
SurchargeTest: test_should_not_save_rate_without_rate_id
SurchargeTest: test_should_not_save_rate_with_an_invalid_rate_id
--------------------------------------------------------
----------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1000], ["LIMIT", 1]]
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
SurchargeTest: test_type_value_attribute_must_be_a_positive_integer
-------------------------------------------------------------------
  [1m[36mSurcharge Create (1.2ms)[0m  [1m[32mINSERT INTO "surcharges" ("item_property", "surcharge_type", "type_value", "rate_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["item_property", "volume"], ["surcharge_type", "monetary"], ["type_value", 5], ["rate_id", 2]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------------------
SurchargeTest: test_discount_type_attribute_must_be_'percentage'_or_'monetary'
------------------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.7ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (15.1ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (15.4ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (1.3ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------
SurchargeTest: test_surcharge_type_attribute_must_be_'percentage'_or_'monetary'
-------------------------------------------------------------------------------
-------------------------------------------------------------------
SurchargeTest: test_type_value_attribute_must_be_a_positive_integer
-------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mSurcharge Create (1.2ms)[0m  [1m[32mINSERT INTO "surcharges" ("item_property", "surcharge_type", "type_value", "rate_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["item_property", "volume"], ["surcharge_type", "monetary"], ["type_value", 5], ["rate_id", 2]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
SurchargeTest: test_should_not_save_rate_with_an_invalid_rate_id
----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
-----------------------------------------------------------------------
SurchargeTest: test_item_property_attribute_must_be_'volume'_or_'value'
-----------------------------------------------------------------------
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1000], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
SurchargeTest: test_should_not_save_rate_without_rate_id
--------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mSurcharge Create (1.1ms)[0m  [1m[32mINSERT INTO "surcharges" ("item_property", "surcharge_type", "type_value", "rate_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["item_property", "volume"], ["surcharge_type", "monetary"], ["type_value", 5], ["rate_id", 2]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (13.6ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (13.2ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (2.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
SurchargeTest: test_should_not_save_rate_with_an_invalid_rate_id
----------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------
SurchargeTest: test_surcharge_type_attribute_must_be_'percentage'_or_'monetary'
-------------------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1000], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
SurchargeTest: test_type_value_attribute_must_be_a_positive_integer
-------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
SurchargeTest: test_item_property_attribute_must_be_'volume'_or_'value'
-----------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
SurchargeTest: test_should_not_save_rate_without_rate_id
--------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mSurcharge Create (1.1ms)[0m  [1m[32mINSERT INTO "surcharges" ("item_property", "surcharge_type", "type_value", "rate_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["item_property", "volume"], ["surcharge_type", "monetary"], ["type_value", 5], ["rate_id", 2]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (8.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (6.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (15.5ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (15.8ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
SurchargeTest: test_item_property_attribute_must_be_'volume'_or_'value'
-----------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
SurchargeTest: test_should_not_save_rate_with_an_invalid_rate_id
----------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------
SurchargeTest: test_surcharge_type_attribute_must_be_'percentage'_or_'monetary'
-------------------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1000], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
SurchargeTest: test_should_not_save_rate_without_rate_id
--------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
SurchargeTest: test_type_value_attribute_must_be_a_positive_integer
-------------------------------------------------------------------
  [1m[36mSurcharge Create (0.8ms)[0m  [1m[32mINSERT INTO "surcharges" ("item_property", "surcharge_type", "type_value", "rate_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["item_property", "volume"], ["surcharge_type", "monetary"], ["type_value", 5], ["rate_id", 2]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (1.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.6ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (20.0ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (17.8ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (8.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (8.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (16.8ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (17.0ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (6.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.8ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (17.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (14.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (3.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
SurchargeTest: test_should_not_save_rate_with_an_invalid_rate_id
----------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
SurchargeTest: test_type_value_attribute_must_be_a_positive_integer
-------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1000], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
SurchargeTest: test_should_not_save_rate_without_rate_id
--------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
SurchargeTest: test_item_property_attribute_must_be_'volume'_or_'value'
-----------------------------------------------------------------------
  [1m[35m (1.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mSurcharge Create (1.3ms)[0m  [1m[32mINSERT INTO "surcharges" ("item_property", "surcharge_type", "type_value", "rate_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["item_property", "volume"], ["surcharge_type", "monetary"], ["type_value", 5], ["rate_id", 2]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------
SurchargeTest: test_surcharge_type_attribute_must_be_'percentage'_or_'monetary'
-------------------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.6ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.9ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (12.3ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.9ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (13.7ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
CriteriaTest: test_should_not_save_rate_without_discount_id
-----------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (1.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (2.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (16.4ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (14.6ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (5.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.8ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
CriteriaTest: test_should_not_save_rate_without_discount_id
-----------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (13.5ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (14.0ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (3.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
CriteriaTest: test_should_not_save_rate_without_discount_id
-----------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDiscount Load (0.3ms)[0m  [1m[34mSELECT "discounts".* FROM "discounts" WHERE "discounts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCriteria Create (1.0ms)[0m  [1m[32mINSERT INTO "criteria" ("criteria_type", "start", "end", "discount_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["criteria_type", "range"], ["start", 1], ["end", 10], ["discount_id", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (1.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.6ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (12.9ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (13.2ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
CriteriaTest: test_should_not_save_rate_without_discount_id
-----------------------------------------------------------
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.6ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (13.1ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (13.1ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (3.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.6ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.4ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
CriteriaTest: test_should_not_save_rate_without_discount_id
-----------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
CriteriaTest: test_start_attribute_must_be_a_positive_integer
-------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDiscount Load (0.5ms)[0m  [1m[34mSELECT "discounts".* FROM "discounts" WHERE "discounts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (1.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (1.6ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (15.8ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (15.7ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (1.2ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.6ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
CriteriaTest: test_should_not_save_rate_without_discount_id
-----------------------------------------------------------
-------------------------------------------------------------
CriteriaTest: test_start_attribute_must_be_a_positive_integer
-------------------------------------------------------------
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDiscount Load (0.2ms)[0m  [1m[34mSELECT "discounts".* FROM "discounts" WHERE "discounts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mCriteria Create (1.2ms)[0m  [1m[32mINSERT INTO "criteria" ("criteria_type", "start", "end", "discount_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["criteria_type", "range"], ["start", 1], ["end", 10], ["discount_id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.6ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (13.8ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (15.1ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
CriteriaTest: test_should_not_save_rate_without_discount_id
-----------------------------------------------------------
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
CriteriaTest: test_start_attribute_must_be_a_positive_integer
-------------------------------------------------------------
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDiscount Load (0.5ms)[0m  [1m[34mSELECT "discounts".* FROM "discounts" WHERE "discounts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (8.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (8.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (14.7ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (14.5ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.6ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (2.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (1.6ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
CriteriaTest: test_should_not_save_rate_without_discount_id
-----------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
CriteriaTest: test_start_attribute_must_be_a_positive_integer
-------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
CriteriaTest: test_end_attribute_must_be_a_positive_integer
-----------------------------------------------------------
  [1m[36mDiscount Load (0.2ms)[0m  [1m[34mSELECT "discounts".* FROM "discounts" WHERE "discounts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDiscount Load (0.2ms)[0m  [1m[34mSELECT "discounts".* FROM "discounts" WHERE "discounts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (13.3ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (13.8ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
CriteriaTest: test_start_attribute_must_be_a_positive_integer
-------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
CriteriaTest: test_discount_type_attribute_must_be_'range'_or_'price'
---------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDiscount Load (0.3ms)[0m  [1m[34mSELECT "discounts".* FROM "discounts" WHERE "discounts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDiscount Load (0.2ms)[0m  [1m[34mSELECT "discounts".* FROM "discounts" WHERE "discounts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
CriteriaTest: test_end_attribute_must_be_a_positive_integer
-----------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mDiscount Load (0.2ms)[0m  [1m[34mSELECT "discounts".* FROM "discounts" WHERE "discounts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
-----------------------------------------------------------
CriteriaTest: test_should_not_save_rate_without_discount_id
-----------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (8.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (8.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (13.2ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (13.1ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
CriteriaTest: test_end_attribute_must_be_a_positive_integer
-----------------------------------------------------------
---------------------------------------------------------------------
CriteriaTest: test_discount_type_attribute_must_be_'range'_or_'price'
---------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDiscount Load (0.2ms)[0m  [1m[34mSELECT "discounts".* FROM "discounts" WHERE "discounts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mDiscount Load (0.3ms)[0m  [1m[34mSELECT "discounts".* FROM "discounts" WHERE "discounts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
CriteriaTest: test_should_not_save_rate_without_discount_id
-----------------------------------------------------------
  [1m[36mCriteria Create (1.2ms)[0m  [1m[32mINSERT INTO "criteria" ("criteria_type", "start", "end", "discount_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["criteria_type", "range"], ["start", 1], ["end", 10], ["discount_id", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
CriteriaTest: test_start_attribute_must_be_a_positive_integer
-------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDiscount Load (0.2ms)[0m  [1m[34mSELECT "discounts".* FROM "discounts" WHERE "discounts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (16.8ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (16.6ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.1ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.4ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
CriteriaTest: test_end_attribute_must_be_a_positive_integer
-----------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
CriteriaTest: test_start_attribute_must_be_a_positive_integer
-------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDiscount Load (0.3ms)[0m  [1m[34mSELECT "discounts".* FROM "discounts" WHERE "discounts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDiscount Load (0.3ms)[0m  [1m[34mSELECT "discounts".* FROM "discounts" WHERE "discounts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
---------------------------------------------------------------------
CriteriaTest: test_should_not_save_rate_without_discount_id
CriteriaTest: test_discount_type_attribute_must_be_'range'_or_'price'
-----------------------------------------------------------
---------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDiscount Load (0.3ms)[0m  [1m[34mSELECT "discounts".* FROM "discounts" WHERE "discounts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (1.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (6.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (195.1ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (7.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (7.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.4ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (14.5ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
---------------------------------------------------------------------
CriteriaTest: test_discount_type_attribute_must_be_'range'_or_'price'
---------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (6.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDiscount Load (0.2ms)[0m  [1m[34mSELECT "discounts".* FROM "discounts" WHERE "discounts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
CriteriaTest: test_end_attribute_must_be_a_positive_integer
-----------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDiscount Load (0.4ms)[0m  [1m[34mSELECT "discounts".* FROM "discounts" WHERE "discounts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
CriteriaTest: test_should_not_save_rate_without_discount_id
-----------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
CriteriaTest: test_start_attribute_must_be_a_positive_integer
-------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDiscount Load (0.3ms)[0m  [1m[34mSELECT "discounts".* FROM "discounts" WHERE "discounts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (6.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (1.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (2.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (18.0ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (18.2ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.3ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (12.8ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.7ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (15.1ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (8.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (8.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (15.9ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (16.2ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.3ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (15.5ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (15.3ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (12.4ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.5ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (15.3ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (15.3ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (15.5ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.8ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
CriteriaTest: test_should_not_save_rate_without_discount_id
-----------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (1.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (3.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (3.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (8.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (7.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (15.1ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (14.8ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.6ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
CriteriaTest: test_discount_type_attribute_must_be_'range'_or_'price'
---------------------------------------------------------------------
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.1ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
CriteriaTest: test_start_attribute_must_be_a_positive_integer
-------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDiscount Load (0.2ms)[0m  [1m[34mSELECT "discounts".* FROM "discounts" WHERE "discounts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDiscount Load (0.2ms)[0m  [1m[34mSELECT "discounts".* FROM "discounts" WHERE "discounts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
CriteriaTest: test_should_not_save_rate_without_discount_id
-----------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (4.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (5.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (15.8ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (16.3ms)[0m  [1m[35mTRUNCATE TABLE "discounts", "criteria", "rates", "customers", "surcharges"[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "discounts" DISABLE TRIGGER ALL;ALTER TABLE "criteria" DISABLE TRIGGER ALL;ALTER TABLE "rates" DISABLE TRIGGER ALL;ALTER TABLE "customers" DISABLE TRIGGER ALL;ALTER TABLE "surcharges" DISABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (1.5ms)[0m  [1m[31mDELETE FROM "discounts";
DELETE FROM "rates";
INSERT INTO "discounts" ("id", "is_flat", "discount_type", "type_value", "rate_id") VALUES (1, FALSE, 'percentage', 10, 2);
INSERT INTO "rates" ("id", "customer_id") VALUES (2, 2)[0m
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "discounts" ENABLE TRIGGER ALL;ALTER TABLE "criteria" ENABLE TRIGGER ALL;ALTER TABLE "rates" ENABLE TRIGGER ALL;ALTER TABLE "customers" ENABLE TRIGGER ALL;ALTER TABLE "surcharges" ENABLE TRIGGER ALL[0m
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
RateTest: test_should_not_save_rate_without_customer_id
-------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
RateTest: test_should_not_save_rate_with_an_invalid_customer_id
---------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------
CriteriaTest: test_discount_type_attribute_must_be_'range'_or_'price'
---------------------------------------------------------------------
  [1m[36mCustomer Load (0.3ms)[0m  [1m[34mSELECT "customers".* FROM "customers" WHERE "customers"."id" = $1 LIMIT $2[0m  [["id", 10000], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
CriteriaTest: test_start_attribute_must_be_a_positive_integer
-------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDiscount Load (0.3ms)[0m  [1m[34mSELECT "discounts".* FROM "discounts" WHERE "discounts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mDiscount Load (0.4ms)[0m  [1m[34mSELECT "discounts".* FROM "discounts" WHERE "discounts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
CriteriaTest: test_should_not_save_rate_without_discount_id
-----------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------------
DiscountTest: test_discount_type_attribute_must_be_'percentage'_or_'monetary'
-----------------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
DiscountTest: test_should_not_save_rate_without_rate_id
-------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
DiscountTest: test_should_not_save_rate_with_an_invalid_rate_id
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
------------------------------------------------------------------
DiscountTest: test_type_value_attribute_must_be_a_positive_integer
------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 10000], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.4ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (1.0ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------------
SurchargeTest: test_item_property_attribute_must_be_'volume'_or_'value'
-----------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
SurchargeTest: test_should_not_save_rate_without_rate_id
--------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
SurchargeTest: test_type_value_attribute_must_be_a_positive_integer
-------------------------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.2ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mSurcharge Create (1.1ms)[0m  [1m[32mINSERT INTO "surcharges" ("item_property", "surcharge_type", "type_value", "rate_id") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["item_property", "volume"], ["surcharge_type", "monetary"], ["type_value", 5], ["rate_id", 2]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
----------------------------------------------------------------
SurchargeTest: test_should_not_save_rate_with_an_invalid_rate_id
----------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 1000], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------------
SurchargeTest: test_surcharge_type_attribute_must_be_'percentage'_or_'monetary'
-------------------------------------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mRate Load (0.3ms)[0m  [1m[34mSELECT "rates".* FROM "rates" WHERE "rates"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
